@page "/contacts/edit/{Id:int}"
@using BlazorAppWithJWT.Models
@using BlazorAppWithJWT.Services
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@rendermode InteractiveServer

@inject ContactService ContactService
@inject NavigationManager Navigation

<h3>Edit Contact</h3>

@if (model == null)
{
    <p>Loading...</p>
}
else
{
    <input @bind="model.FirstName" />
    <input @bind="model.LastName" />
    <input @bind="model.Email" />
    <input @bind="model.Phone" />

    <button @onclick="Update">Update</button>
}

@code {
    [Parameter] public int Id { get; set; }

    private ContactFormModel? model;

    protected override async Task OnInitializedAsync()
    {
        var contact = await ContactService.GetByIdAsync(Id);

        if (contact == null)
            return;

        model = new ContactFormModel
        {
            ContactId = contact.ContactId,
            FirstName = contact.FirstName ?? string.Empty,
            LastName = contact.LastName ?? string.Empty,
            Email = contact.Email,
            Phone = contact.Phone
        };
    }

    private async Task Update()
    {
        if (model == null)
            return;

        await ContactService.UpdateAsync(model.ContactId, model);
        Navigation.NavigateTo("/contacts");
    }
}
